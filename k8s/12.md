# Lab 12

## ConfigMap and volumes

[`files/config.json`](./helm/python-app/files/config.json) inside a Helm chart:

```json
{
    "REDIS_PORT": 6379
}
```

[`config.yaml`](./helm/python-app/templates/config.yaml):

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: redis-config
data:
  config.json: |- {{ .Files.Get "files/config.json" | nindent 4 }}
```

[`deployment.yaml`](./helm/python-app/templates/deployment.yaml):

```diff
+    volumes:
+      - name: redis-config
+        configMap:
+          name: redis-config
      containers:
        - name: {{ .Chart.Name }}
+          volumeMounts:
+          - name: redis-config
+            mountPath: "/config"
+            readOnly: true
```

Test:

```sh
kubectl exec $(kubectl get po -l "app.kubernetes.io/instance=py-app"
-o jsonpath="{.items[0].metadata.name}") -- cat /config/config.json
```

```sh
{
    "REDIS_PORT": 6379
}
```
